import{d as H,k as c,p as D,l as I,G as V,H as B,u as N,m as F,n as J,v as _,g as L,_ as O,r as s,o as k,x as $,w as t,a as n,c as z,b as u,t as a,f as r,y as q}from"./index-ca663933.js";import{A as G,R as j}from"./ActionsDropdown-89f509d1.js";import{P as Q}from"./PageTitle-82077c23.js";const U=H({name:"MyApps",components:{PageTitle:Q,ActionsDropdown:G,RefreshTokenModal:j},setup(){const{notify:e}=L(),l=c(""),w=c([]),C=c(0),R=D(()=>C.value.toString()),d=c(null),p=c(!1),h=c(null),{portalApiV2:m}=I(),b=V(),{isDcr:v}=B(b),S=N().state.helpText.myApp,A=c({paginationPageSizes:[25,50,100],initialPageSize:25}),M=D(()=>{var i;return`Delete ${(i=d.value)==null?void 0:i.name}`}),{state:E,send:f}=F(J({predictableActionArguments:!0,id:"DeveloperMachine",initial:"idle",states:{idle:{on:{FETCH:"pending",REJECT:"error"}},pending:{on:{RESOLVE:"success",REJECT:"error"}},success:{type:"final"},error:{on:{FETCH:"pending"}}}})),o=()=>{C.value+=1};return{modalTitle:M,errorMessage:l,applications:w,currentState:E,tableHeaders:[{label:"Name",key:"name"},{label:"Description",key:"description"},{hideLabel:!0,key:"actions"}],handleDelete:()=>{m.value.service.applicationsApi.deleteApplication({applicationId:d.value.id}).then(()=>{d.value=null,o(),e({message:"Application deleted"})}).catch(i=>{d.value=null,e({appearance:"danger",message:`Error: ${_(i)}`})})},isDcr:v,deleteItem:d,showSecretModal:p,token:h,onModalClose:()=>{p.value=!1,h.value=null},handleRefreshSecret:i=>{m.value.service.credentialsApi.refreshApplicationToken({applicationId:i}).then(g=>{e({message:"Successfully refreshed secret"}),p.value=!0,h.value=g.data.client_secret}).catch(g=>{e({appearance:"danger",message:_(g)})})},fetcherCacheKey:R,fetcher:async i=>{const{pageSize:g,page:K}=i,P={pageNumber:K,pageSize:g};return f("FETCH"),m.value.service.applicationsApi.listApplications(P).then(T=>(f("RESOLVE"),{data:T.data.data,total:T.data.meta.page.total})).catch(T=>{f("REJECT"),l.value=_(T)})},paginationConfig:A,helpText:S}}});const W={width:"16",height:"16",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"mr-2"},X=u("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M16 8A8 8 0 110 8a8 8 0 0116 0zM7 5a1 1 0 012 0v2h2a1 1 0 110 2H9v2a1 1 0 11-2 0V9H5a1 1 0 110-2h2V5z",fill:"#fff","fill-opacity":".75"},null,-1),Y=["onClick"],Z=["onClick"];function x(e,l,w,C,R,d){const p=s("KButton"),h=s("PageTitle"),m=s("ActionsDropdown"),b=s("router-link"),v=s("EmptyState"),S=s("KTable"),A=s("KCard"),M=s("KModal"),E=s("RefreshTokenModal"),f=s("Content");return k(),$(f,null,{default:t(()=>[n(h,{title:e.helpText.myApps,class:"mb-6"},{right:t(()=>[n(p,{"data-testid":"create-application-button",appearance:"primary","is-rounded":!1,to:{name:"create-application"}},{default:t(()=>[(k(),z("svg",W,[u("title",null,a(e.helpText.plus),1),X])),r(" "+a(e.helpText.newApp),1)]),_:1})]),_:1},8,["title"]),u("div",null,[n(A,null,{body:t(()=>[n(S,{"data-testid":"applications-table","fetcher-cache-key":e.fetcherCacheKey,fetcher:e.fetcher,"has-side-border":"","has-error":e.currentState.matches("error"),"is-loading":e.currentState.matches("pending"),headers:e.tableHeaders,"is-clickable":"","is-small":"",class:"applications-table","pagination-page-sizes":e.paginationConfig.paginationPageSizes,"initial-fetcher-params":{pageSize:e.paginationConfig.initialPageSize},"onRow:click":l[0]||(l[0]=(o,y)=>e.$router.push({name:"show-application",params:{application_id:y.id}}))},{name:t(({row:o})=>[r(a(o.name),1)]),actions:t(({row:o})=>[(k(),$(m,{key:o.id},{content:t(()=>[e.isDcr?(k(),z("div",{key:0,"data-testid":"dropdown-refresh-application-dcr-token",class:"py-2 px-3 type-md cursor-pointer",onClick:y=>e.handleRefreshSecret(o.id)},a(e.helpText.refreshSecret),9,Y)):q("",!0),u("div",{"data-testid":"dropdown-delete-application",class:"py-2 px-3 type-md cursor-pointer delete-item",onClick:y=>e.deleteItem=o},a(e.helpText.delete),9,Z)]),_:2},1024))]),"empty-state":t(()=>[n(v,{title:e.helpText.noApp},{message:t(()=>[u("p",null,[n(b,{"data-testid":"create-application-link",to:{name:"create-application"}},{default:t(()=>[r(a(e.helpText.create),1)]),_:1}),r(" "+a(e.helpText.getStarted),1)])]),_:1},8,["title"])]),"error-state":t(()=>[n(v,{"is-error":"",title:e.helpText.noApp},{message:t(()=>[u("p",null,a("Error: "+e.errorMessage),1)]),_:1},8,["title"])]),_:1},8,["fetcher-cache-key","fetcher","has-error","is-loading","headers","pagination-page-sizes","initial-fetcher-params"])]),_:1})]),n(M,{title:e.modalTitle,"is-visible":!!e.deleteItem,"action-button-text":e.helpText.delete,"action-button-appearance":"danger",class:"delete-modal",onCanceled:l[2]||(l[2]=o=>e.deleteItem=null)},{"header-content":t(()=>[r(a(e.modalTitle),1)]),"body-content":t(()=>[r(a(e.helpText.deleteDialog(e.deleteItem.name)),1)]),"footer-content":t(()=>[n(p,{appearance:"danger","is-rounded":!1,class:"mr-3",onClick:e.handleDelete},{default:t(()=>[r(a(e.helpText.delete),1)]),_:1},8,["onClick"]),n(p,{appearance:"secondary","is-rounded":!1,onClick:l[1]||(l[1]=o=>e.deleteItem=null)},{default:t(()=>[r(a(e.helpText.cancel),1)]),_:1})]),_:1},8,["title","is-visible","action-button-text"]),n(E,{"is-visible":e.showSecretModal,token:e.token,onClosed:e.onModalClose},null,8,["is-visible","token","onClosed"])]),_:1})}const ie=O(U,[["render",x]]);export{ie as default};
